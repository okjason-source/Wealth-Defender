var Q=Object.defineProperty;var tt=(u,t,e)=>t in u?Q(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e;var s=(u,t,e)=>tt(u,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const h of n)if(h.type==="childList")for(const a of h.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const h={};return n.integrity&&(h.integrity=n.integrity),n.referrerPolicy&&(h.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?h.credentials="include":n.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(n){if(n.ep)return;n.ep=!0;const h=e(n);fetch(n.href,h)}})();const g={GOLD:"#FFD700",AMBER:"#FFA500",DEEP_PURPLE:"#4B0082",RICH_BLACK:"#0A0A0A",PLATINUM:"#C0C0C0",EMERALD_GREEN:"#50C878",SAPPHIRE_BLUE:"#0F52BA",CRIMSON_RED:"#DC143C",PURE_WHITE:"#FFFFFF",DOLLAR_BILL_GREEN:"#228B22",DIAMOND_BLUE:"#0F52BA",DIAMOND_LIGHT:"#87CEEB",COIN_GOLD:"#FFD700",COIN_BRONZE:"#CD7F32",HATER_RED:"#DC143C",HATER_PURPLE:"#4B0082",STAR_COLOR:"#C0C0C0"},E={TRANSPARENT:0,BLACK:1,GOLD:2,AMBER:3,DEEP_PURPLE:4,PLATINUM:5,DOLLAR_GREEN:6,WHITE:7,DIAMOND_BLUE:8,DIAMOND_LIGHT:9,COIN_GOLD:10,COIN_BRONZE:11,HATER_RED:12,HATER_PURPLE:13,CRIMSON:14,EMERALD:15},et={[E.TRANSPARENT]:"transparent",[E.BLACK]:g.RICH_BLACK,[E.GOLD]:g.GOLD,[E.AMBER]:g.AMBER,[E.DEEP_PURPLE]:g.DEEP_PURPLE,[E.PLATINUM]:g.PLATINUM,[E.DOLLAR_GREEN]:g.DOLLAR_BILL_GREEN,[E.WHITE]:g.PURE_WHITE,[E.DIAMOND_BLUE]:g.DIAMOND_BLUE,[E.DIAMOND_LIGHT]:g.DIAMOND_LIGHT,[E.COIN_GOLD]:g.COIN_GOLD,[E.COIN_BRONZE]:g.COIN_BRONZE,[E.HATER_RED]:g.HATER_RED,[E.HATER_PURPLE]:g.HATER_PURPLE,[E.CRIMSON]:g.CRIMSON_RED,[E.EMERALD]:g.EMERALD_GREEN};class it{constructor(t,e=4){s(this,"ctx");s(this,"canvas");s(this,"pixelSize");this.canvas=t,this.ctx=t.getContext("2d"),this.pixelSize=e,this.ctx.imageSmoothingEnabled=!1}setPixelSize(t){this.pixelSize=t}clear(){this.ctx.fillStyle="#0A0A0A",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}drawPixel(t,e,i){i!=="transparent"&&(this.ctx.fillStyle=i,this.ctx.fillRect(t*this.pixelSize,e*this.pixelSize,this.pixelSize,this.pixelSize))}blendColors(t,e,i=.5){const n=parseInt(t.slice(1,3),16),h=parseInt(t.slice(3,5),16),a=parseInt(t.slice(5,7),16),o=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),l=parseInt(e.slice(5,7),16),c=Math.round(n*(1-i)+o*i),d=Math.round(h*(1-i)+r*i),m=Math.round(a*(1-i)+l*i);return`#${c.toString(16).padStart(2,"0")}${d.toString(16).padStart(2,"0")}${m.toString(16).padStart(2,"0")}`}drawSprite(t,e,i,n){for(let h=0;h<t.length;h++)for(let a=0;a<t[h].length;a++){const o=t[h][a];let r=et[o]||"transparent";n&&r!=="transparent"&&(r=this.blendColors(r,n,.5)),this.drawPixel(e+a,i+h,r)}}drawParticle(t,e,i,n,h){if(h<=0)return;const a=this.getContext(),o=a.globalAlpha;a.globalAlpha=h,a.fillStyle=i,a.fillRect(t*this.pixelSize,e*this.pixelSize,n*this.pixelSize,n*this.pixelSize),a.globalAlpha=o}drawRect(t,e,i,n,h){this.ctx.fillStyle=h,this.ctx.fillRect(t*this.pixelSize,e*this.pixelSize,i*this.pixelSize,n*this.pixelSize)}drawText(t,e,i,n,h=1,a="left"){this.ctx.fillStyle=n,this.ctx.font=`${h*this.pixelSize*8}px 'Courier New', monospace`,this.ctx.textBaseline="top",this.ctx.textAlign=a;let o=e*this.pixelSize;a==="center"?o=e*this.pixelSize:a==="right"&&(o=e*this.pixelSize),this.ctx.fillText(t,o,i*this.pixelSize),this.ctx.textAlign="left"}getContext(){return this.ctx}getPixelSize(){return this.pixelSize}}class st{constructor(){s(this,"keys",new Set);s(this,"mouseX",0);s(this,"mouseY",0);s(this,"mouseDown",!1);s(this,"spacePressed",!1);s(this,"lastKeyStates",new Set);s(this,"justPressedKeys",new Set);this.setupEventListeners()}setupEventListeners(){window.addEventListener("keydown",t=>{this.keys.add(t.key.toLowerCase()),t.key===" "&&(t.preventDefault(),this.spacePressed=!0)}),window.addEventListener("keyup",t=>{this.keys.delete(t.key.toLowerCase()),t.key===" "&&(this.spacePressed=!1)}),window.addEventListener("mousemove",t=>{this.mouseX=t.clientX,this.mouseY=t.clientY}),window.addEventListener("mousedown",t=>{t.button===0&&(this.mouseDown=!0)}),window.addEventListener("mouseup",t=>{t.button===0&&(this.mouseDown=!1)}),window.addEventListener("contextmenu",t=>{t.preventDefault()})}isKeyPressed(t){return this.keys.has(t.toLowerCase())}isMovingLeft(){return this.isKeyPressed("a")||this.isKeyPressed("arrowleft")}isMovingRight(){return this.isKeyPressed("d")||this.isKeyPressed("arrowright")}isMovingUp(){return this.isKeyPressed("w")||this.isKeyPressed("arrowup")}isMovingDown(){return this.isKeyPressed("s")||this.isKeyPressed("arrowdown")}isAutoFirePressed(){return this.spacePressed}isLaserPressed(){return this.mouseDown||this.isKeyPressed("z")}getMousePosition(){return{x:this.mouseX,y:this.mouseY}}getMousePositionInGame(t){const e=t.getBoundingClientRect(),i=4,n=200,h=150,a=Math.floor((this.mouseX-e.left)/i),o=Math.floor((this.mouseY-e.top)/i);return{x:Math.max(0,Math.min(a,n)),y:Math.max(0,Math.min(o,h))}}update(){this.justPressedKeys.clear();for(const t of this.keys)this.lastKeyStates.has(t)||this.justPressedKeys.add(t);this.lastKeyStates=new Set(this.keys)}wasKeyJustPressed(t){return this.justPressedKeys.has(t.toLowerCase())}}const N=[[0,0,0,1,1,0,0,0],[0,0,2,3,3,2,0,0],[0,2,3,3,3,3,2,0],[2,3,3,3,3,3,3,2],[2,2,2,2,2,2,2,2]],nt=[[0,0,0,0,6,6,6,6,0,0,0,0],[0,0,0,6,7,2,2,7,6,0,0,0],[0,0,6,7,2,7,7,2,7,6,0,0],[0,6,7,2,7,6,6,7,2,7,6,0],[6,7,2,7,6,0,0,6,7,2,7,6],[0,6,7,2,7,6,6,7,2,7,6,0],[0,0,6,7,2,7,7,2,7,6,0,0],[0,0,0,6,7,2,2,7,6,0,0,0]],U=[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,6,6,6,6,6,6,6,0,0],[0,6,7,2,7,6,6,7,2,7,6,0],[6,7,2,7,6,6,6,6,7,2,7,6],[6,7,2,7,6,6,6,6,7,2,7,6],[0,6,7,2,7,6,6,7,2,7,6,0],[0,0,6,6,6,6,6,6,6,6,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]],ht=[[0,0,0,6,7,2,2,7,6,0,0,0],[0,0,6,7,2,7,7,2,7,6,0,0],[0,6,7,2,7,6,6,7,2,7,6,0],[6,7,2,7,6,0,0,6,7,2,7,6],[0,6,7,2,7,6,6,7,2,7,6,0],[0,0,6,7,2,7,7,2,7,6,0,0],[0,0,0,6,7,2,2,7,6,0,0,0],[0,0,0,0,6,6,6,6,0,0,0,0]],k=[nt,U,ht,U],K=[[0,0,0,8,8,0,0,0],[0,0,8,9,9,8,0,0],[0,8,9,5,5,9,8,0],[8,9,5,8,8,5,9,8],[0,8,9,5,5,9,8,0],[0,0,8,9,9,8,0,0],[0,0,0,8,8,0,0,0],[0,0,0,0,0,0,0,0]],at=[[0,0,0,8,8,0,0,0],[0,0,8,9,9,8,0,0],[0,8,5,5,5,9,8,0],[8,5,5,8,8,5,9,8],[0,8,9,5,5,9,8,0],[0,0,8,9,9,8,0,0],[0,0,0,8,8,0,0,0],[0,0,0,0,0,0,0,0]],$=[[0,0,0,5,5,0,0,0],[0,0,8,5,5,8,0,0],[0,8,9,5,5,9,8,0],[8,9,5,5,5,5,9,8],[0,8,9,5,5,9,8,0],[0,0,8,9,9,8,0,0],[0,0,0,8,8,0,0,0],[0,0,0,0,0,0,0,0]],ot=[[0,0,0,8,8,0,0,0],[0,0,8,9,9,8,0,0],[0,8,9,5,5,5,8,0],[8,9,5,8,8,5,5,8],[0,8,9,5,5,9,8,0],[0,0,8,9,9,8,0,0],[0,0,0,8,8,0,0,0],[0,0,0,0,0,0,0,0]],rt=[[0,0,0,8,8,0,0,0],[0,0,8,9,9,8,0,0],[0,8,9,5,5,9,8,0],[8,9,5,8,8,5,9,8],[0,8,9,5,5,9,8,0],[0,0,8,9,9,8,0,0],[0,0,0,8,8,0,0,0],[0,0,0,0,0,0,0,0]],W=[K,at,$,ot,rt,$,K],F=[[0,0,10,10,10,10,0,0],[0,10,10,10,10,10,10,0],[10,10,11,11,11,11,10,10],[10,11,11,10,10,11,11,10],[10,11,11,10,10,11,11,10],[10,10,11,11,11,11,10,10],[0,10,10,10,10,10,10,0],[0,0,10,10,10,10,0,0]],j=[[0,0,13,13,13,13,0,0],[0,13,12,12,12,12,13,0],[13,12,1,1,1,1,12,13],[13,12,1,12,12,1,12,13],[13,12,1,1,1,1,12,13],[13,12,12,12,12,12,12,13],[13,12,12,12,12,12,12,13],[0,13,12,0,0,12,13,0],[0,0,12,0,0,12,0,0],[0,0,12,0,0,12,0,0]],G=[[2],[2],[3],[2]],z=[[7],[7],[7],[7]];var O=(u=>(u[u.PLAYER=0]="PLAYER",u[u.ENEMY=1]="ENEMY",u))(O||{});class lt{constructor(t,e,i,n,h){s(this,"x");s(this,"y");s(this,"vx");s(this,"vy");s(this,"type");s(this,"width");s(this,"height");s(this,"active",!0);this.x=t,this.y=e,this.vx=i,this.vy=n,this.type=h,h===0?(this.width=G[0].length,this.height=G.length):(this.width=z[0].length,this.height=z.length)}update(t){this.active&&(this.x+=this.vx*(t/16.67),this.y+=this.vy*(t/16.67))}isOutOfBounds(t,e){return this.x<0||this.x>t||this.y<0||this.y>e}getSprite(){return this.type===0?G:z}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}}class ct{constructor(t,e){s(this,"projectiles",[]);s(this,"gameWidth");s(this,"gameHeight");this.gameWidth=t,this.gameHeight=e}createProjectile(t,e,i,n,h){this.projectiles.push(new lt(t,e,i,n,h))}update(t){for(const e of this.projectiles)e.active&&(e.update(t),e.isOutOfBounds(this.gameWidth,this.gameHeight)&&(e.active=!1));this.projectiles=this.projectiles.filter(e=>e.active)}getProjectiles(){return this.projectiles.filter(t=>t.active)}getPlayerProjectiles(){return this.projectiles.filter(t=>t.active&&t.type===0)}getEnemyProjectiles(){return this.projectiles.filter(t=>t.active&&t.type===1)}removeProjectile(t){t.active=!1}clear(){this.projectiles=[]}}class _{constructor(t,e,i,n,h,a){s(this,"x");s(this,"y");s(this,"width");s(this,"height");s(this,"speed",3.5);s(this,"input");s(this,"projectileManager");s(this,"gameWidth");s(this,"gameHeight");s(this,"velocityX",0);s(this,"velocityY",0);s(this,"acceleration",.25);s(this,"friction",.15);s(this,"maxSpeed",3.5);s(this,"autoFireCooldown",0);s(this,"autoFireRate",8);s(this,"laserCooldown",0);s(this,"laserRate",30);this.x=t,this.y=e,this.width=N[0].length,this.height=N.length,this.input=i,this.projectileManager=n,this.gameWidth=h,this.gameHeight=a}update(t,e,i,n){const h=t/16.67;let a=0,o=0;e!==void 0&&i!==void 0?(a=e*this.maxSpeed,o=i*this.maxSpeed):(this.input.isMovingLeft()?a=-this.maxSpeed:this.input.isMovingRight()&&(a=this.maxSpeed),this.input.isMovingUp()?o=-this.maxSpeed:this.input.isMovingDown()&&(o=this.maxSpeed)),a!==0?this.velocityX<a?this.velocityX=Math.min(a,this.velocityX+this.acceleration*h):this.velocityX>a&&(this.velocityX=Math.max(a,this.velocityX-this.acceleration*h)):(this.velocityX>0?this.velocityX=Math.max(0,this.velocityX-this.friction*h):this.velocityX<0&&(this.velocityX=Math.min(0,this.velocityX+this.friction*h)),Math.abs(this.velocityX)<.1&&(this.velocityX=0)),o!==0?this.velocityY<o?this.velocityY=Math.min(o,this.velocityY+this.acceleration*h):this.velocityY>o&&(this.velocityY=Math.max(o,this.velocityY-this.acceleration*h)):(this.velocityY>0?this.velocityY=Math.max(0,this.velocityY-this.friction*h):this.velocityY<0&&(this.velocityY=Math.min(0,this.velocityY+this.friction*h)),Math.abs(this.velocityY)<.1&&(this.velocityY=0));const r=this.x+this.velocityX*h,l=this.y+this.velocityY*h;this.x=Math.max(0,Math.min(r,this.gameWidth-this.width)),this.y=Math.max(0,Math.min(l,this.gameHeight-this.height)),(this.x<=0||this.x>=this.gameWidth-this.width)&&(this.velocityX=0),(this.y<=0||this.y>=this.gameHeight-this.height)&&(this.velocityY=0),this.updateWeapons(t,n)}updateWeapons(t,e){if(this.autoFireCooldown>0&&(this.autoFireCooldown-=t/16.67),this.laserCooldown>0&&(this.laserCooldown-=t/16.67),(e!==void 0?e:this.input.isAutoFirePressed())&&this.autoFireCooldown<=0&&(this.fireAutoCannon(),this.autoFireCooldown=this.autoFireRate),!e&&this.input.isLaserPressed()&&this.laserCooldown<=0){const n=this.input.getMousePositionInGame(document.getElementById("game-canvas"));this.fireLaser(n.x,n.y),this.laserCooldown=this.laserRate}}fireAutoCannon(){const t=this.x+this.width/2,e=this.y;this.projectileManager.createProjectile(t,e,0,-4,O.PLAYER)}fireLaser(t,e){const i=this.x+this.width/2,n=this.y,h=t-i,a=e-n,o=Math.sqrt(h*h+a*a);if(o>0){const l=h/o*6,c=a/o*6;this.projectileManager.createProjectile(i,n,l,c,O.PLAYER)}}getSprite(){return N}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}getCenter(){return{x:this.x+this.width/2,y:this.y+this.height/2}}}class dt{constructor(t,e,i,n,h,a=.001,o=1,r,l=!1){s(this,"enemies",[]);s(this,"x",0);s(this,"y",0);s(this,"vx",1);s(this,"vy",.1);s(this,"gameWidth");s(this,"gameHeight");s(this,"enemySpacing",18);s(this,"direction",1);s(this,"enemyType");s(this,"rowHeight",20);s(this,"lastCoordinatedAttack",0);s(this,"coordinatedAttackCooldown",180);s(this,"strategicTimer",0);s(this,"projectileManager",null);s(this,"canShoot",!1);this.enemyType=t,this.y=e,this.vy=.15*o,t===f.HATER?this.vx=1.5*o:this.vx=1*o,this.gameWidth=n,this.gameHeight=h,this.projectileManager=r||null,this.canShoot=l;let c=8;switch(t){case f.DOLLAR_BILL:c=12;break;case f.DIAMOND:c=8;break;case f.COIN:c=8;break;case f.HATER:c=8;break}const d=i>0?i:Math.floor((n-10)/(c+this.enemySpacing));let m=this.enemySpacing;(d-1)*m+c>n-10&&(m=Math.max(8,(n-10-c)/(d-1)));const C=(d-1)*m+c,b=Math.max(5,(n-C)/2);for(let I=0;I<d;I++){const T=new V(b+I*m,e,0,0,t,"straight",n,h,this.projectileManager||void 0,this.canShoot);T.setLinePosition(I*m),T.setBreakawayChance(a),this.enemies.push(T)}this.x=b,this.enemySpacing=m}update(t,e,i){const n=t/16.67;if(this.strategicTimer+=n,this.lastCoordinatedAttack+=n,this.enemies.length===0)return;const h=this.enemies.filter(r=>r.active);if(h.length===0)return;const a=h[0].width,o=(h.length-1)*this.enemySpacing+a;if(this.enemyType===f.HATER)this.x+=this.vx*n,this.x+o>this.gameWidth-5&&(this.x=5,this.y+=this.rowHeight,this.y+this.rowHeight>this.gameHeight-20&&(this.y=0));else{this.x+=this.vx*this.direction*n;const r=0,l=this.gameWidth-o;this.x<=r?(this.direction=1,this.x=r,this.y+=this.vy*5):this.x>=l&&(this.direction=-1,this.x=l,this.y+=this.vy*5),this.y+=this.vy*n,this.y>this.gameHeight&&(this.y=0)}e!==void 0&&i!==void 0&&this.executeStrategicAttacks(e,i);for(const r of this.enemies)r.active&&r.update(t,this.x,this.y,this.vx*this.direction,this.vy,e,i);this.enemies=this.enemies.filter(r=>r.active)}executeStrategicAttacks(t,e){const i=this.enemies.filter(l=>l.active&&l.isInLineFormation());if(i.length===0)return;const n=this.x+(i.length-1)*this.enemySpacing/2,h=Math.abs(n-t),a=e-this.y,o=a>0&&a<80,r=h<30;if(o&&r&&this.lastCoordinatedAttack>=this.coordinatedAttackCooldown){const l=Math.min(3,Math.floor(i.length*.3)),c=[...i].sort((d,m)=>{const S=Math.abs(this.x+d.getLinePosition()-t),C=Math.abs(this.x+m.getLinePosition()-t);return S-C});for(let d=0;d<l;d++)c[d]&&c[d].triggerStrategicBreakaway(t,e);this.lastCoordinatedAttack=0}if(this.strategicTimer>60&&this.lastCoordinatedAttack>=this.coordinatedAttackCooldown*.7&&(this.direction>0&&n>t+20||this.direction<0&&n<t-20)&&o){const c=i.filter(d=>{const m=this.x+d.getLinePosition();return this.direction>0?m<n:m>n});c.length>0&&(c[Math.floor(Math.random()*c.length)].triggerStrategicBreakaway(t,e),this.lastCoordinatedAttack=0)}if(a>0&&a<40&&this.lastCoordinatedAttack>=this.coordinatedAttackCooldown*.5){const l=i.filter(c=>{const d=this.x+c.getLinePosition();return Math.abs(d-t)<40});l.length>0&&Math.random()<.3&&(l[Math.floor(Math.random()*l.length)].triggerStrategicBreakaway(t,e),this.lastCoordinatedAttack=0)}}getEnemies(){return this.enemies.filter(t=>t.active)}getEnemyCount(){return this.enemies.filter(t=>t.active).length}isComplete(){return this.enemies.filter(t=>t.active).length===0}getY(){return this.y}setBreakawayChance(t){for(const e of this.enemies)e.setBreakawayChance(t)}}var f=(u=>(u[u.DOLLAR_BILL=0]="DOLLAR_BILL",u[u.DIAMOND=1]="DIAMOND",u[u.COIN=2]="COIN",u[u.HATER=3]="HATER",u))(f||{});class V{constructor(t,e,i,n,h,a="straight",o=200,r=150,l,c=!1){s(this,"x");s(this,"y");s(this,"vx");s(this,"vy");s(this,"type");s(this,"width");s(this,"height");s(this,"active",!0);s(this,"health",1);s(this,"maxHealth",1);s(this,"isInLine",!0);s(this,"lineX",0);s(this,"breakawayChance",.001);s(this,"breakawaySpeed",2);s(this,"breakawayTargetY",0);s(this,"isReturning",!1);s(this,"isFalling",!1);s(this,"fallSpeed",0);s(this,"patternTime",0);s(this,"gameWidth",200);s(this,"gameHeight",150);s(this,"animationFrame",0);s(this,"animationTimer",0);s(this,"animationSpeed",8);s(this,"projectileManager",null);s(this,"canShoot",!1);s(this,"shootCooldown",0);s(this,"shootCooldownMax",180);s(this,"shootChance",.3);switch(this.x=t,this.y=e,this.vx=i,this.vy=n,this.type=h,this.gameWidth=o,this.gameHeight=r,this.projectileManager=l||null,this.canShoot=c,h){case 0:this.width=k[0][0].length,this.height=k[0].length,this.health=2,this.maxHealth=2,this.animationFrame=Math.floor(Math.random()*k.length);break;case 1:this.width=W[0][0].length,this.height=W[0].length,this.health=3,this.maxHealth=3,this.animationFrame=Math.floor(Math.random()*W.length);break;case 2:this.width=F[0].length,this.height=F.length,this.health=1,this.maxHealth=1;break;case 3:this.width=j[0].length,this.height=j.length,this.health=2,this.maxHealth=2;break}}update(t,e,i,n,h,a,o){if(!this.active)return;const r=t/16.67;if(this.patternTime+=r,this.type===0&&(this.animationTimer+=r,this.animationTimer>=this.animationSpeed&&(this.animationTimer=0,this.animationFrame=(this.animationFrame+1)%k.length)),this.type===1&&(this.animationTimer+=r,this.animationTimer>=12&&(this.animationTimer=0,this.animationFrame=(this.animationFrame+1)%W.length)),this.isFalling){this.y+=this.fallSpeed*r,this.y>this.gameHeight&&(this.y=0,this.x=5+Math.random()*(this.gameWidth-10-this.width)),this.shootCooldown>0&&(this.shootCooldown-=r);return}if(this.shootCooldown>0&&(this.shootCooldown-=r),this.canShoot&&this.isInLine&&this.shootCooldown<=0&&a!==void 0&&o!==void 0&&(Math.random()<this.shootChance?(this.shootAtPlayer(a,o),this.shootCooldown=this.shootCooldownMax):this.shootCooldown=this.shootCooldownMax*.3),this.isInLine){this.x=e+this.lineX,this.y=i,this.type!==3&&(this.x<0?this.x=0:this.x+this.width>this.gameWidth&&(this.x=this.gameWidth-this.width));let l=1;if(a!==void 0&&o!==void 0){const c=Math.abs(this.x-a),d=o-this.y;c<30&&d>0&&d<60?l=3:(a<20||a>this.gameWidth-20)&&d>0&&(l=2)}Math.random()<this.breakawayChance*r*l&&this.triggerBreakaway(a,o)}else if(this.isReturning){const l=e+this.lineX,c=i,d=l-this.x,m=c-this.y,S=Math.sqrt(d*d+m*m);S<2?(this.isInLine=!0,this.isReturning=!1,this.x=l,this.y=c,this.vx=0,this.vy=0):(this.vx=d/S*this.breakawaySpeed,this.vy=m/S*this.breakawaySpeed,this.x+=this.vx*r,this.y+=this.vy*r)}else{if(a!==void 0&&o!==void 0){const l=a-this.x,c=o-this.y;if(Math.sqrt(l*l+c*c)>5){const S=a+this.vx*.3,C=o,b=S-this.x,I=C-this.y,T=Math.sqrt(b*b+I*I);T>0&&(this.vx=b/T*this.breakawaySpeed,this.vy=I/T*this.breakawaySpeed)}}if(this.y+=this.vy*r,this.x+=this.vx*r,this.y>=this.breakawayTargetY||o!==void 0&&this.y>=o-10){this.isReturning=!0;const l=e+this.lineX,c=i,d=l-this.x,m=c-this.y,S=Math.sqrt(d*d+m*m);S>0?(this.vx=d/S*this.breakawaySpeed,this.vy=m/S*this.breakawaySpeed):(this.vx=0,this.vy=-this.breakawaySpeed)}}!this.isInLine&&this.type!==3&&(this.x<0?(this.x=0,this.vx=-this.vx):this.x+this.width>this.gameWidth&&(this.x=this.gameWidth-this.width,this.vx=-this.vx),this.y+this.height>this.gameHeight&&(this.y=0,this.isReturning),this.y<-this.height&&(this.y=this.gameHeight))}setLinePosition(t){this.lineX=t}setBreakawayChance(t){this.breakawayChance=t}isInLineFormation(){return this.isInLine}getLinePosition(){return this.lineX}triggerStrategicBreakaway(t,e){this.isInLine&&this.triggerBreakaway(t,e)}triggerBreakaway(t,e){if(this.isInLine=!1,this.isReturning=!1,t!==void 0&&e!==void 0){this.breakawayTargetY=e;const i=t-this.x,n=e-this.y,h=Math.sqrt(i*i+n*n);h>0?(this.vx=i/h*this.breakawaySpeed,this.vy=n/h*this.breakawaySpeed):(this.vx=(Math.random()-.5)*.5,this.vy=this.breakawaySpeed)}else this.breakawayTargetY=this.gameHeight-30,this.vx=(Math.random()-.5)*.5,this.vy=this.breakawaySpeed}takeDamage(t){this.health-=t,this.health<=0&&(this.active=!1)}isDamaged(){return this.health<this.maxHealth}getHealthRatio(){return this.health/this.maxHealth}isOutOfBounds(t,e){return this.x<-this.width-50||this.x>t+50||this.y<-this.height-50||this.y>e+50}getSprite(){switch(this.type){case 0:return k[this.animationFrame];case 1:return W[this.animationFrame];case 2:return F;case 3:return j}}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}getCenter(){return{x:this.x+this.width/2,y:this.y+this.height/2}}shootAtPlayer(t,e){if(!this.projectileManager)return;const i=this.getCenter(),n=t-i.x,h=e-i.y,a=Math.sqrt(n*n+h*h);if(a>0){const r=n/a*1.8,l=h/a*1.8;this.projectileManager.createProjectile(i.x,i.y,r,l,O.ENEMY)}}setCanShoot(t){this.canShoot=t}setFallingMode(t=1){this.isFalling=!0,this.isInLine=!1,this.fallSpeed=.3*t,this.vx=0,this.vy=this.fallSpeed}isFallingMode(){return this.isFalling}}class gt{constructor(t,e,i){s(this,"enemies",[]);s(this,"enemyLines",[]);s(this,"fallingEnemies",[]);s(this,"gameWidth");s(this,"gameHeight");s(this,"projectileManager");this.gameWidth=t,this.gameHeight=e,this.projectileManager=i}spawnEnemyLine(t,e,i,n=.001,h=1,a=!1){const o=new dt(t,e,i,this.gameWidth,this.gameHeight,n,h,this.projectileManager,a);this.enemyLines.push(o)}spawnFallingEnemy(t,e,i,n=1,h=!1){const a=new V(e,i,0,0,t,"straight",this.gameWidth,this.gameHeight,this.projectileManager,h);a.setFallingMode(n),this.fallingEnemies.push(a)}update(t,e,i){for(const n of this.enemyLines)n.update(t,e,i);this.enemyLines=this.enemyLines.filter(n=>!n.isComplete());for(const n of this.fallingEnemies)n.active&&n.update(t,0,0,0,0,e,i);this.fallingEnemies=this.fallingEnemies.filter(n=>n.active),this.enemies=[];for(const n of this.enemyLines)this.enemies.push(...n.getEnemies());this.enemies.push(...this.fallingEnemies.filter(n=>n.active))}getEnemies(){return this.enemies.filter(t=>t.active)}removeEnemy(t){t.active=!1}clear(){this.enemies=[],this.enemyLines=[],this.fallingEnemies=[]}getEnemyCount(){return this.enemies.filter(t=>t.active).length}}class mt{rectOverlap(t,e,i,n,h,a,o,r){return t<h+o&&t+i>h&&e<a+r&&e+n>a}checkPlayerEnemy(t,e){const i=t.getBounds(),n=e.getBounds();return this.rectOverlap(i.x,i.y,i.width,i.height,n.x,n.y,n.width,n.height)}checkProjectileEnemy(t,e){if(t.type!==O.PLAYER)return!1;const i=t.getBounds(),n=e.getBounds();return this.rectOverlap(i.x,i.y,i.width,i.height,n.x,n.y,n.width,n.height)}checkProjectilePlayer(t,e){if(t.type!==O.ENEMY)return!1;const i=t.getBounds(),n=e.getBounds();return this.rectOverlap(i.x,i.y,i.width,i.height,n.x,n.y,n.width,n.height)}checkAllCollisions(t,e,i){const n={playerHit:!1,enemiesHit:[],projectilesToRemove:[]};for(const h of i)this.checkProjectilePlayer(h,t)&&(n.playerHit=!0,n.projectilesToRemove.push(h));for(const h of e)this.checkPlayerEnemy(t,h)&&(n.playerHit=!0);for(const h of i)for(const a of e)if(this.checkProjectileEnemy(h,a)){a.takeDamage(1),n.projectilesToRemove.push(h),a.active||n.enemiesHit.push(a);break}return n}}class ut{constructor(t,e,i){s(this,"enemyManager");s(this,"currentRound",1);s(this,"currentWaveIndex",0);s(this,"currentWaveSpawnIndex",0);s(this,"spawnTimer",0);s(this,"isSpawning",!1);s(this,"roundDefinition",null);s(this,"enemiesSpawned",0);s(this,"enemiesDestroyed",0);this.enemyManager=t}startRound(t){this.currentRound=t,this.currentWaveIndex=0,this.currentWaveSpawnIndex=0,this.spawnTimer=0,this.roundDefinition=this.generateRoundDefinition(t),this.isSpawning=!0,this.enemiesSpawned=0,this.enemiesDestroyed=0}update(t){if(!this.isSpawning||!this.roundDefinition)return;if(this.currentWaveIndex>=this.roundDefinition.waves.length){this.isSpawning=!1;return}const e=this.roundDefinition.waves[this.currentWaveIndex];if(e.formation==="line"&&e.count===0){this.currentWaveSpawnIndex===0?(this.spawnEnemyFromWave(e,0),this.currentWaveSpawnIndex=1):(this.currentWaveIndex++,this.currentWaveSpawnIndex=0,this.spawnTimer=0);return}if(this.currentWaveSpawnIndex>=e.count){this.currentWaveIndex++,this.currentWaveSpawnIndex=0,this.spawnTimer=0;return}const i=t/16.67;this.spawnTimer+=i,this.spawnTimer>=e.spawnDelay&&(this.spawnEnemyFromWave(e,this.currentWaveSpawnIndex),this.currentWaveSpawnIndex++,this.spawnTimer=0)}spawnEnemyFromWave(t,e){if(t.formation==="meteor"){const i=5+Math.random()*182,n=1+(this.currentRound-1)*.05,a=Math.floor((this.currentRound-1)/4)+1>=2;this.enemyManager.spawnFallingEnemy(t.enemyType,i,0,n,a),this.enemiesSpawned++;return}if(t.formation==="line"&&e===0){const h=Math.min(25,this.currentWaveIndex*10),a=5e-4+this.currentRound*1e-4,o=1+(this.currentRound-1)*.05,l=Math.floor((this.currentRound-1)/4)+1>=2;this.enemyManager.spawnEnemyLine(t.enemyType,h,t.count,a,o,l),this.enemiesSpawned+=t.count}}onEnemyDestroyed(){this.enemiesDestroyed++}generateRoundDefinition(t){const e=[];let i,n=!1;t<=36?i=[f.COIN,f.DOLLAR_BILL,f.DIAMOND,f.HATER][(t-1)%4]:(n=!0,i=f.COIN);let h;t<=36?h=(Math.floor((t-1)/4)+1)*10:h=100;let a=1;if(h>20&&(a=2),h>50&&(a=3),h>=100&&(a=4),n&&t>=37){const r=[f.COIN,f.DOLLAR_BILL,f.DIAMOND,f.HATER],l=Math.ceil(h/a);for(let c=0;c<a;c++){const d=r[c%4],m=d===f.COIN&&l>=50,S=d===f.HATER?Math.max(6,14-Math.floor(h/20)):Math.max(8,18-Math.floor(h/15));e.push({enemyType:d,count:l,spawnDelay:m?15:0,formation:m?"meteor":"line",spacing:S})}}else{const r=Math.ceil(h/a);if(i===f.COIN&&h>=50)for(let c=0;c<r;c++)e.push({enemyType:i,count:1,spawnDelay:15,formation:"meteor",spacing:0});else if(i===f.HATER){const c=Math.max(6,14-Math.floor(h/20));for(let d=0;d<a;d++)e.push({enemyType:i,count:r,spawnDelay:0,formation:"line",spacing:c})}else for(let c=0;c<a;c++)e.push({enemyType:i,count:r,spawnDelay:0,formation:"line",spacing:Math.max(8,18-Math.floor(h/15))})}const o=e.reduce((r,l)=>r+l.count,0);return{round:t,waves:e,totalEnemies:o}}isRoundComplete(){return!this.isSpawning&&this.enemyManager.getEnemyCount()===0}getCurrentRound(){return this.currentRound}getRoundDefinition(){return this.roundDefinition}}class q{constructor(t,e,i){s(this,"x");s(this,"y");s(this,"vx");s(this,"vy");s(this,"life");s(this,"maxLife");s(this,"color");s(this,"size");s(this,"active",!0);this.x=t,this.y=e,this.color=i,this.maxLife=20,this.life=this.maxLife,this.size=2;const n=Math.random()*Math.PI*2,h=1+Math.random()*2;this.vx=Math.cos(n)*h,this.vy=Math.sin(n)*h}update(){this.active&&(this.x+=this.vx,this.y+=this.vy,this.vx*=.95,this.vy*=.95,this.life--,this.life<=0&&(this.active=!1))}getAlpha(){return this.life/this.maxLife}}class ft{constructor(t,e){s(this,"particles",[])}createExplosion(t,e,i,n=8){for(let h=0;h<n;h++)this.particles.push(new q(t,e,i))}createConfettiExplosion(t,e,i=24){const n=["#FF00FF","#00FFFF","#FFFF00","#FF00FF","#00FF00","#FF1493","#00CED1","#FFD700","#FF69B4","#00FA9A","#FF4500","#9370DB"];for(let h=0;h<i;h++){const a=n[Math.floor(Math.random()*n.length)];this.particles.push(new q(t,e,a))}}update(){for(const t of this.particles)t.update();this.particles=this.particles.filter(t=>t.active)}getParticles(){return this.particles.filter(t=>t.active)}clear(){this.particles=[]}}class yt{constructor(){s(this,"isActive",!1);s(this,"lastDecisionTime",0);s(this,"decisionInterval",5);s(this,"gamesPlayed",0);s(this,"bestScore",0);s(this,"bestRound",0);s(this,"totalScore",0);s(this,"averageScore",0);s(this,"reactionSpeed",1);s(this,"avoidanceSkill",1);s(this,"positioningSkill",1);s(this,"aggressionLevel",.5);s(this,"lastGameRound",0);this.loadLearningData()}loadLearningData(){try{const t=localStorage.getItem("round42_bot_learning");if(t){const e=JSON.parse(t);this.gamesPlayed=e.gamesPlayed||0,this.bestScore=e.bestScore||0,this.bestRound=e.bestRound||0,this.totalScore=e.totalScore||0,this.averageScore=e.averageScore||0,this.reactionSpeed=e.reactionSpeed||1,this.avoidanceSkill=e.avoidanceSkill||1,this.positioningSkill=e.positioningSkill||1,this.aggressionLevel=e.aggressionLevel||.5,console.log("Bot learning data loaded:",{games:this.gamesPlayed,skillLevel:Math.round(this.getSkillLevel()*100)+"%"})}}catch(t){console.warn("Failed to load bot learning data:",t)}}saveLearningData(){try{const t={gamesPlayed:this.gamesPlayed,bestScore:this.bestScore,bestRound:this.bestRound,totalScore:this.totalScore,averageScore:this.averageScore,reactionSpeed:this.reactionSpeed,avoidanceSkill:this.avoidanceSkill,positioningSkill:this.positioningSkill,aggressionLevel:this.aggressionLevel};localStorage.setItem("round42_bot_learning",JSON.stringify(t))}catch(t){console.warn("Failed to save bot learning data:",t)}}toggle(){this.isActive=!this.isActive}isBotActive(){return this.isActive}onGameEnd(t,e){this.lastGameRound=e,this.gamesPlayed++,this.totalScore+=t,this.averageScore=this.totalScore/this.gamesPlayed;const i=this.bestScore>0?t/this.bestScore:1,n=this.bestRound>0?e/this.bestRound:1,h=(i+n)/2;t>this.bestScore&&(this.bestScore=t,this.improveSkills(.15)),e>this.bestRound&&(this.bestRound=e,this.improveSkills(.1)),t>this.averageScore*.8&&this.improveSkills(.05),h<.5&&this.gamesPlayed>3&&(this.improveSkills(-.01),console.log("Bot learned from poor performance")),this.improveSkills(.02),this.saveLearningData(),console.log(`Bot Stats - Games: ${this.gamesPlayed}, Best Score: ${this.bestScore}, Best Round: ${this.bestRound}, Avg Score: ${Math.round(this.averageScore)}`),console.log(`Bot Skills - Reaction: ${this.reactionSpeed.toFixed(2)}, Avoidance: ${this.avoidanceSkill.toFixed(2)}, Positioning: ${this.positioningSkill.toFixed(2)}`)}improveSkills(t){this.reactionSpeed=Math.max(.8,Math.min(2,this.reactionSpeed+t*.1)),this.avoidanceSkill=Math.max(.8,Math.min(2,this.avoidanceSkill+t*.15)),this.positioningSkill=Math.max(.8,Math.min(2,this.positioningSkill+t*.12)),this.lastGameRound>5?this.aggressionLevel=Math.max(.2,Math.min(.9,this.aggressionLevel+t*.05)):this.aggressionLevel=Math.max(.2,Math.min(.9,this.aggressionLevel-t*.02))}getSkillLevel(){return(this.reactionSpeed+this.avoidanceSkill+this.positioningSkill)/6}update(t,e,i,n,h,a){if(!this.isActive)return{moveX:0,moveY:0,shouldShoot:!1};const o=Math.max(2,this.decisionInterval/this.reactionSpeed);if(a-this.lastDecisionTime<o)return{moveX:0,moveY:0,shouldShoot:!0};this.lastDecisionTime=a;const r=t.getBounds(),l=r.x+r.width/2,c=r.y+r.height/2;let d=0,m=0,S=!0,C=null,b=1/0;const I=60*this.avoidanceSkill;for(const L of i){if(L.type!==O.ENEMY)continue;const B=L.getBounds(),H=B.x+B.width/2,x=B.y+B.height/2,v=l-H,M=c-x,w=Math.sqrt(v*v+M*M),R=L.vx,y=L.vy,p=Math.sqrt(R*R+y*y),D=w/Math.max(p,.1),P=30/this.avoidanceSkill;if(w<I&&D<P){const A=Math.atan2(M,v),Z=Math.atan2(y,R),X=Math.abs(A-Z);(Math.min(X,Math.PI*2-X)<Math.PI/2||w<30)&&w<b&&(C=L,b=w)}}if(C){const L=C.getBounds(),B=L.x+L.width/2,H=L.y+L.height/2,x=l-B,v=c-H,M=Math.sqrt(x*x+v*v),w=C.vx,y=-C.vy,p=w,D=Math.sqrt(y*y+p*p);if(D>0)d=y/D*this.avoidanceSkill,m=p/D*this.avoidanceSkill,d+=x/M*.5*this.avoidanceSkill,m+=v/M*.5*this.avoidanceSkill,d=Math.max(-1,Math.min(1,d)),m=Math.max(-1,Math.min(1,m));else{const P=Math.sqrt(x*x+v*v);P>0?(d=x/P*this.avoidanceSkill,m=v/P*this.avoidanceSkill):(d=x>0?1:-1,m=v>0?1:-1)}}else if(e.length>0){let L=null,B=1/0;const H=25;for(const x of e){const v=x.getBounds(),M=v.x+v.width/2,w=v.y+v.height/2,R=M-l,y=w-c,p=Math.sqrt(R*R+y*y);p<B&&(B=p,L=x)}if(L&&B<H){const x=L.getBounds(),v=x.x+x.width/2,M=x.y+x.height/2,w=l-v,R=c-M,y=Math.sqrt(w*w+R*R);y>0&&(d=w/y*this.avoidanceSkill,m=R/y*this.avoidanceSkill,Math.abs(w)>Math.abs(R)?m*=.5:d*=.5)}else{let x=null,v=-1/0;for(const M of e){const w=M.getBounds(),R=w.x+w.width/2,y=w.y+w.height/2,p=R-l,D=y-c,P=Math.sqrt(p*p+D*D);let A=100/(P+1);P<H&&(A-=50),D>0&&(A+=20),Math.abs(p)<20&&(A+=30),y>c+10&&(A+=15),Math.abs(D)<15&&(A+=15),this.positioningSkill>1.5&&(A+=10),A>v&&(v=A,x=M)}if(x){const M=x.getBounds(),w=M.x+M.width/2,R=M.y+M.height/2,y=w-l,p=R-c,D=40,P=Math.sqrt(y*y+p*p);P>D?(Math.abs(y)>3&&(d=(y>0?1:-1)*this.positioningSkill),Math.abs(p)>3&&(m=(p>0?1:-1)*this.positioningSkill*.8)):(Math.abs(y)>2&&(d=(y>0?.5:-.5)*this.positioningSkill),Math.abs(p)>5&&(m=(p>0?.3:-.3)*this.positioningSkill));const A=30;this.aggressionLevel>.7&&P>A?(d=(y>0?1:-1)*this.aggressionLevel,Math.abs(p)>10&&(m=(p>0?.7:-.7)*this.aggressionLevel)):P<A&&(d=(y<0?1:-1)*.8,Math.abs(p)>5&&(m=p<0?.6:-.6))}}}const T=r.x+d*t.speed,Y=r.y+m*t.speed;return(T<0||T+r.width>n)&&(d=0),(Y<0||Y+r.height>h)&&(m=0),{moveX:d,moveY:m,shouldShoot:S}}}class pt{constructor(t,e){s(this,"walls",[]);s(this,"life");s(this,"gameWidth");s(this,"gameHeight");s(this,"pathWidth",45);s(this,"segments",8);s(this,"segmentHeight");s(this,"playerAutoSpeed",.5);s(this,"lifeCollected",!1);s(this,"exited",!1);this.gameWidth=t,this.gameHeight=e,this.segmentHeight=e/this.segments,this.generateMaze(),this.placeLife()}generateMaze(){this.walls=[];let t=this.gameWidth/2;const e=(this.gameWidth-this.pathWidth)/2-10;for(let i=0;i<this.segments;i++){const n=i*this.segmentHeight;if(i===0)t=this.gameWidth/2;else{const o=(Math.random()-.5)*e*.3,l=t+o-t,c=Math.max(-15,Math.min(15,l));t=Math.max(this.pathWidth/2+5,Math.min(this.gameWidth-this.pathWidth/2-5,t+c))}t-this.pathWidth/2>0&&this.walls.push({x:0,y:n,width:t-this.pathWidth/2,height:this.segmentHeight});const h=t+this.pathWidth/2;if(h<this.gameWidth&&this.walls.push({x:h,y:n,width:this.gameWidth-h,height:this.segmentHeight}),i>1&&i<this.segments-2&&Math.random()<.15){const a=Math.random()<.5?"left":"right",o=6+Math.random()*8,r=a==="left"?t-this.pathWidth/2:t+this.pathWidth/2-o;this.walls.push({x:r,y:n+this.segmentHeight*.3,width:o,height:this.segmentHeight*.3})}}this.walls=this.walls.filter(i=>{if(i.y<this.segmentHeight){const n=this.gameWidth/2,h=n-this.pathWidth/2,a=n+this.pathWidth/2;if(i.x+i.width>h&&i.x<a)return!1}return!0})}placeLife(){const e=(2+Math.floor(Math.random()*(this.segments-4)))*this.segmentHeight+this.segmentHeight/2,i=this.gameWidth/2+(Math.random()-.5)*(this.pathWidth/2-10);this.life={x:i,y:e,collected:!1}}updatePlayer(t,e,i,n,h,a){let o=e-this.playerAutoSpeed,r=t;const l=1.5;return h&&(r-=l),a&&(r+=l),r=Math.max(0,Math.min(r,this.gameWidth-i)),o=Math.max(0,o),{x:r,y:o}}checkWallCollision(t,e,i,n){for(const h of this.walls)if(t<h.x+h.width&&t+i>h.x&&e<h.y+h.height&&e+n>h.y)return!0;return!1}checkLifeCollection(t,e,i,n){if(this.life.collected)return!1;const h=8;return t<this.life.x+h&&t+i>this.life.x&&e<this.life.y+h&&e+n>this.life.y?(this.life.collected=!0,this.lifeCollected=!0,!0):!1}checkExit(t){return t<=0||t<this.gameHeight*.05?(this.exited=!0,!0):!1}getWalls(){return this.walls}getLife(){return this.life.collected?null:this.life}wasLifeCollected(){return this.lifeCollected}hasExited(){return this.exited}reset(){this.lifeCollected=!1,this.exited=!1,this.generateMaze(),this.placeLife()}}class xt{constructor(t){s(this,"renderer");s(this,"canvas");s(this,"isRunning",!1);s(this,"lastTime",0);s(this,"gameWidth",200);s(this,"gameHeight",150);s(this,"pixelSize",4);s(this,"input");s(this,"player");s(this,"projectileManager");s(this,"enemyManager");s(this,"collisionSystem");s(this,"spawningSystem");s(this,"particleSystem");s(this,"botAI");s(this,"bonusMaze",null);s(this,"frameCount",0);s(this,"score",0);s(this,"lives",3);s(this,"round",1);s(this,"roundTransitionTimer",0);s(this,"roundTransitionDuration",120);s(this,"isInRoundTransition",!1);s(this,"invincibilityTimer",0);s(this,"invincibilityDuration",60);s(this,"respawnTimer",0);s(this,"respawnDelay",30);s(this,"isRespawning",!1);s(this,"isGameOver",!1);s(this,"highScore",0);s(this,"isBonusRound",!1);s(this,"bonusRoundComplete",!1);s(this,"gameLoop",(t=performance.now())=>{if(!this.isRunning)return;const e=t-this.lastTime;this.lastTime=t;const n=1e3/60;e>=n&&(this.update(e),this.render()),requestAnimationFrame(this.gameLoop)});this.canvas=t,this.setupCanvas(),this.renderer=new it(t,this.pixelSize),this.input=new st,this.projectileManager=new ct(this.gameWidth,this.gameHeight),this.enemyManager=new gt(this.gameWidth,this.gameHeight,this.projectileManager),this.collisionSystem=new mt,this.particleSystem=new ft(this.gameWidth,this.gameHeight),this.botAI=new yt,this.spawningSystem=new ut(this.enemyManager,this.gameWidth,this.gameHeight),this.player=new _(this.gameWidth/2-4,this.gameHeight-5,this.input,this.projectileManager,this.gameWidth,this.gameHeight);const e=localStorage.getItem("round42_highscore");e&&(this.highScore=parseInt(e,10)),this.startRound(this.round,!1)}setupCanvas(){this.canvas.width=this.gameWidth*this.pixelSize,this.canvas.height=this.gameHeight*this.pixelSize,this.canvas.style.width=`${this.canvas.width}px`,this.canvas.style.height=`${this.canvas.height}px`}start(){this.isRunning||(this.isRunning=!0,this.lastTime=performance.now(),this.gameLoop())}startRound(t,e=!1){if(this.round=t,this.isInRoundTransition=!0,this.roundTransitionTimer=0,this.projectileManager.clear(),this.enemyManager.clear(),this.particleSystem.clear(),this.isRespawning=!1,this.respawnTimer=0,this.bonusRoundComplete=!1,this.isBonusRound=e,!this.player)this.player=new _(this.gameWidth/2-4,this.gameHeight-5,this.input,this.projectileManager,this.gameWidth,this.gameHeight);else{const i=this.player.getBounds();this.player.x=this.gameWidth/2-i.width/2,this.player.y=this.gameHeight-5}this.isBonusRound?(this.bonusMaze=new pt(this.gameWidth,this.gameHeight),this.invincibilityTimer=30):(this.bonusMaze=null,this.spawningSystem.startRound(t))}stop(){this.isRunning=!1}update(t){if(this.input.update(),this.frameCount++,this.input.wasKeyJustPressed("b")&&(this.botAI.toggle(),console.log("Bot toggled:",this.botAI.isBotActive()?"ON":"OFF")),this.isGameOver){if(this.botAI.isBotActive()){this.frameCount%60===0&&this.restartGame();return}if(this.input.isKeyPressed(" ")||this.input.isKeyPressed("enter")||this.input.isKeyPressed("r")){this.restartGame();return}return}if(this.isInRoundTransition){this.roundTransitionTimer+=t/16.67,this.roundTransitionTimer>=this.roundTransitionDuration&&(this.isInRoundTransition=!1),this.isBonusRound||(this.spawningSystem.update(t),this.enemyManager.update(t));return}if(this.isBonusRound&&this.bonusMaze&&!this.bonusRoundComplete){this.updateBonusRound(t);return}if(this.isRespawning){const e=t/16.67;if(this.respawnTimer-=e,this.respawnTimer<=0){if(!this.player)this.player=new _(this.gameWidth/2-4,this.gameHeight-5,this.input,this.projectileManager,this.gameWidth,this.gameHeight);else{const i=this.player.getBounds();this.player.x=this.gameWidth/2-i.width/2,this.player.y=this.gameHeight-5}this.invincibilityTimer=this.invincibilityDuration,this.isRespawning=!1}}else if(this.invincibilityTimer>0&&(this.invincibilityTimer-=t/16.67),this.botAI.isBotActive()&&this.player){const e=this.enemyManager.getEnemies(),i=this.projectileManager.getProjectiles().filter(h=>h.type===O.ENEMY),n=this.botAI.update(this.player,e,i,this.gameWidth,this.gameHeight,this.frameCount);this.player.update(t,n.moveX,n.moveY,n.shouldShoot)}else this.player.update(t);if(this.projectileManager.update(t),this.spawningSystem.update(t),this.player&&!this.isRespawning){const e=this.player.getBounds(),i=e.x+e.width/2,n=e.y+e.height/2;this.enemyManager.update(t,i,n)}else this.enemyManager.update(t);if(this.particleSystem.update(),!this.isBonusRound&&this.spawningSystem.isRoundComplete()){this.completeRound();return}if(this.player&&!this.isRespawning&&this.invincibilityTimer<=0){const e=this.collisionSystem.checkAllCollisions(this.player,this.enemyManager.getEnemies(),this.projectileManager.getProjectiles());if(e.playerHit){this.handlePlayerHit();return}for(const i of e.projectilesToRemove)this.projectileManager.removeProjectile(i);for(const i of e.enemiesHit){this.score+=this.getEnemyPoints(i.type),this.spawningSystem.onEnemyDestroyed();const n=i.getCenter(),h=this.getExplosionColor(i.type);this.particleSystem.createExplosion(n.x,n.y,h,8)}}}completeRound(){if(!this.isBonusRound){const t=this.round*100;this.score+=t}if(this.round>=42){console.log("Victory! All 42 rounds completed!"),this.stop();return}if(this.round%4===0&&!this.isBonusRound){this.startRound(this.round,!0);return}if(this.isBonusRound){this.startRound(this.round+1,!1);return}this.startRound(this.round+1,!1)}updateBonusRound(t){if(!this.bonusMaze||!this.player)return;const e=this.player.getBounds(),i=this.input.isMovingLeft(),n=this.input.isMovingRight(),h=this.bonusMaze.updatePlayer(e.x,e.y,e.width,e.height,i,n);this.player.x=h.x,this.player.y=h.y;const a=this.player.getBounds();if(this.invincibilityTimer>0&&(this.invincibilityTimer-=1),this.invincibilityTimer<=0&&this.bonusMaze.checkWallCollision(a.x,a.y,a.width,a.height)){if(this.lives--,this.lives<=0){this.handleGameOver();return}this.bonusMaze.reset(),this.player.x=this.gameWidth/2-a.width/2,this.player.y=this.gameHeight-5,this.invincibilityTimer=30;return}if(this.bonusMaze.checkLifeCollection(a.x,a.y,a.width,a.height)){this.lives++;const o={x:a.x+a.width/2,y:a.y+a.height/2};this.particleSystem.createConfettiExplosion(o.x,o.y,16)}if(this.bonusMaze.checkExit(a.y)){this.bonusRoundComplete=!0;const o=500;this.score+=o,setTimeout(()=>{this.completeRound()},1e3)}}getEnemyPoints(t){switch(t){case f.COIN:return 10;case f.DOLLAR_BILL:return 25;case f.DIAMOND:return 50;case f.HATER:return 100}}getExplosionColor(t){switch(t){case f.COIN:return g.GOLD;case f.DOLLAR_BILL:return g.EMERALD_GREEN;case f.DIAMOND:return g.SAPPHIRE_BLUE;case f.HATER:return g.CRIMSON_RED;default:return g.AMBER}}getDamageTint(t){return g.CRIMSON_RED}handlePlayerHit(){if(this.isRespawning)return;const t=this.player.getBounds(),e={x:t.x+t.width/2,y:t.y+t.height/2};if(this.particleSystem.createConfettiExplosion(e.x,e.y,24),this.lives--,this.lives<=0){this.handleGameOver();return}this.isRespawning=!0,this.respawnTimer=this.respawnDelay,this.player=null}render(){if(this.renderer.clear(),this.drawStars(),this.isGameOver){this.drawGameOver();return}if(this.drawHUD(),this.isInRoundTransition){this.drawRoundTransition();return}if(this.isBonusRound&&this.bonusMaze){this.drawBonusRound();return}if(this.player&&!this.isRespawning&&(this.invincibilityTimer<=0||Math.floor(this.invincibilityTimer/3)%2===0)){const t=this.player.getSprite();this.renderer.drawSprite(t,Math.floor(this.player.getBounds().x),Math.floor(this.player.getBounds().y))}for(const t of this.enemyManager.getEnemies()){const e=t.getSprite(),i=t.getBounds(),n=t.isDamaged()?this.getDamageTint(t.type):void 0;this.renderer.drawSprite(e,Math.floor(i.x),Math.floor(i.y),n)}for(const t of this.particleSystem.getParticles())this.renderer.drawParticle(t.x,t.y,t.color,t.size,t.getAlpha());for(const t of this.projectileManager.getProjectiles()){const e=t.getSprite();this.renderer.drawSprite(e,Math.floor(t.getBounds().x),Math.floor(t.getBounds().y))}}drawRoundTransition(){const t=this.roundTransitionTimer/this.roundTransitionDuration,e=this.isBonusRound?"BONUS ROUND!":`ROUND ${this.round}`;if(this.renderer.drawText(e,this.gameWidth/2,this.gameHeight/2-10,this.isBonusRound?g.EMERALD_GREEN:g.GOLD,1.5,"center"),t<.7){const i=this.isBonusRound?"STEER LEFT/RIGHT!":"GET READY!";this.renderer.drawText(i,this.gameWidth/2,this.gameHeight/2+5,g.PLATINUM,.8,"center")}}drawBonusRound(){if(!this.bonusMaze)return;const t=this.bonusMaze.getWalls();for(const i of t){const n=Math.floor(i.y/5)%2===0?g.CRIMSON_RED:g.PLATINUM;this.renderer.drawRect(Math.floor(i.x),Math.floor(i.y),Math.floor(i.width),Math.floor(i.height),n)}const e=this.bonusMaze.getLife();if(e&&(this.renderer.drawRect(Math.floor(e.x-4),Math.floor(e.y-4),8,8,g.GOLD),this.renderer.drawRect(Math.floor(e.x-1),Math.floor(e.y-3),2,6,g.RICH_BLACK),this.renderer.drawRect(Math.floor(e.x-3),Math.floor(e.y-1),6,2,g.RICH_BLACK)),this.player&&!this.isRespawning){const i=this.player.getSprite();this.renderer.drawSprite(i,Math.floor(this.player.getBounds().x),Math.floor(this.player.getBounds().y))}for(const i of this.particleSystem.getParticles())this.renderer.drawParticle(i.x,i.y,i.color,i.size,i.getAlpha());this.renderer.drawText("BONUS ROUND",this.gameWidth/2-40,10,g.EMERALD_GREEN,.6),this.renderer.drawText("GET THE LIFE!",this.gameWidth/2-35,18,g.GOLD,.5)}handleGameOver(){this.isGameOver=!0,this.score>this.highScore&&(this.highScore=this.score,localStorage.setItem("round42_highscore",this.highScore.toString())),this.botAI.isBotActive()&&this.botAI.onGameEnd(this.score,this.round)}restartGame(){this.score=0,this.lives=3,this.round=1,this.isGameOver=!1,this.isInRoundTransition=!1,this.isRespawning=!1,this.invincibilityTimer=0,this.respawnTimer=0,this.roundTransitionTimer=0,this.frameCount=0,this.projectileManager.clear(),this.enemyManager.clear(),this.particleSystem.clear(),this.player=new _(this.gameWidth/2-4,this.gameHeight-5,this.input,this.projectileManager,this.gameWidth,this.gameHeight),this.startRound(this.round,!1),this.start()}drawGameOver(){if(this.renderer.drawText("GAME OVER",this.gameWidth/2,this.gameHeight/2-40,g.CRIMSON_RED,1.5,"center"),this.renderer.drawText(`FINAL SCORE: ${this.score}`,this.gameWidth/2,this.gameHeight/2-20,g.GOLD,.8,"center"),this.renderer.drawText(`ROUND REACHED: ${this.round}/42`,this.gameWidth/2,this.gameHeight/2-10,g.EMERALD_GREEN,.7,"center"),this.highScore>0){const t=this.score===this.highScore?"NEW HIGH SCORE!":`HIGH SCORE: ${this.highScore}`,e=this.score===this.highScore?g.GOLD:g.PLATINUM;this.renderer.drawText(t,this.gameWidth/2,this.gameHeight/2+5,e,.7,"center")}this.renderer.drawText("PRESS SPACE/ENTER/R TO RESTART",this.gameWidth/2,this.gameHeight/2+25,g.PLATINUM,.6,"center")}drawHUD(){this.renderer.drawText(`SCORE: ${this.score}`,5,5,g.GOLD,.5),this.renderer.drawText(`LIVES: ${this.lives}`,5,12,g.PLATINUM,.5),this.renderer.drawText(`ROUND: ${this.round}/42`,5,19,g.EMERALD_GREEN,.5);const t=this.enemyManager.getEnemyCount();if(this.renderer.drawText(`ENEMIES: ${t}`,5,26,g.SAPPHIRE_BLUE,.5),this.highScore>0&&this.renderer.drawText(`HIGH: ${this.highScore}`,5,33,g.AMBER,.4),this.botAI.isBotActive()){const e=this.botAI.getSkillLevel(),i=Math.round(e*100);this.renderer.drawText(`BOT: ON (${i}%)`,this.gameWidth-60,5,g.EMERALD_GREEN,.5)}else this.renderer.drawText("BOT: OFF (Press B)",this.gameWidth-75,5,g.PLATINUM,.4)}drawStars(){for(let e=0;e<50;e++){const i=e*37%this.gameWidth,n=e*73%this.gameHeight;this.renderer.drawPixel(i,n,g.STAR_COLOR)}}getRenderer(){return this.renderer}getGameWidth(){return this.gameWidth}getGameHeight(){return this.gameHeight}}const J=document.getElementById("game-canvas");if(!J)throw new Error("Canvas element not found!");const vt=new xt(J);vt.start();window.addEventListener("resize",()=>{});console.log("Wealth Defender - Billionaire Mindset initialized!");
